<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Markdown</title>
  <link rel="stylesheet" href="libs/bootstrap-icons.min.css">
  <style>
    /* ===== Reset & Base ===== */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #dee0e3; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #bbbfc4; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Microsoft YaHei", sans-serif; }
    body { background: #f5f6f7; color: #1f2329; font-size: 14px; line-height: 1.6; }

    /* ===== Layout ===== */
    .layout { display: flex; height: 100vh; }

    /* ===== Sidebar ===== */
    .sidebar {
      width: 260px; min-width: 260px; background: #fff;
      border-right: 1px solid #e5e6eb; display: flex; flex-direction: column;
      transition: transform .25s ease;
    }
    .sidebar-header {
      padding: 20px 20px 0; display: flex; align-items: center; gap: 10px;
    }
    .sidebar-logo {
      width: 32px; height: 32px; border-radius: 8px; background: linear-gradient(135deg, #3370ff, #5b8def);
      display: flex; align-items: center; justify-content: center; flex-shrink: 0;
    }
    .sidebar-logo svg { width: 18px; height: 18px; fill: #fff; }
    .sidebar-title { font-size: 16px; font-weight: 600; color: #1f2329; }
    .sidebar-search { padding: 16px 16px 8px; }
    .sidebar-search input {
      width: 100%; height: 32px; padding: 0 12px 0 34px; border: 1px solid #dee0e3;
      border-radius: 8px; font-size: 13px; color: #1f2329; background: #f5f6f7;
      outline: none; transition: all .2s;
    }
    .sidebar-search input:focus { border-color: #3370ff; background: #fff; box-shadow: 0 0 0 2px rgba(51,112,255,.12); }
    .sidebar-search .search-wrap { position: relative; }
    .sidebar-search .search-icon {
      position: absolute; left: 10px; top: 50%; transform: translateY(-50%);
      width: 14px; height: 14px; color: #8f959e; pointer-events: none;
    }
    .sidebar-nav { flex: 1; overflow-y: auto; padding: 4px 12px 16px; }
    .sidebar-nav .nav-group-label {
      font-size: 13px; font-weight: 500; color: #1f2329;
      padding: 8px 8px; user-select: none; cursor: pointer;
      display: flex; align-items: center; gap: 6px; border-radius: 6px;
      transition: background .15s;
    }
    .sidebar-nav .nav-group-label:hover { background: #f0f1f5; }
    .sidebar-nav .nav-group-label .arrow {
      width: 16px; height: 16px; color: #8f959e; transition: transform .2s; flex-shrink: 0;
    }
    .sidebar-nav .nav-group-label.open .arrow { transform: rotate(90deg); }
    .sidebar-nav .nav-group-items { display: none; padding-left: 4px; }
    .sidebar-nav .nav-group-items.open { display: block; }
    .nav-item a {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 12px; border-radius: 8px; font-size: 14px;
      color: #1f2329; text-decoration: none; cursor: pointer;
      transition: all .15s ease; user-select: none;
    }
    .nav-item a:hover { background: #f0f1f5; }
    .nav-item a.active { background: #e8edfb; color: #3370ff; font-weight: 500; }
    .nav-item .nav-icon {
      font-size: 14px; color: #646a73; flex-shrink: 0; width: 18px; text-align: center;
    }
    .nav-item a.active .nav-icon { color: #3370ff; }
    .nav-item .nav-label { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

    /* ===== Main Area ===== */
    .main-area { flex: 1; display: flex; flex-direction: column; overflow: hidden; background: #f5f6f7; }

    /* ===== Topbar ===== */
    .topbar {
      height: 56px; padding: 0 28px; background: #fff;
      border-bottom: 1px solid #e5e6eb;
      display: flex; align-items: center; justify-content: space-between;
    }
    .topbar-title {
      font-size: 15px; font-weight: 600; color: #1f2329;
      overflow: hidden; text-overflow: ellipsis; white-space: nowrap;
    }
    .topbar-actions { display: flex; align-items: center; gap: 6px; }
    .topbar-btn {
      display: inline-flex; align-items: center; gap: 5px;
      padding: 6px 14px; border-radius: 8px; font-size: 13px; font-weight: 500;
      border: 1px solid #dee0e3; background: #fff; color: #1f2329;
      cursor: pointer; transition: all .15s; user-select: none;
    }
    .topbar-btn:hover { background: #f5f6f7; border-color: #c9cdd4; }
    .topbar-btn:active { background: #eef0f3; }
    .topbar-btn svg { width: 14px; height: 14px; color: #646a73; }
    .topbar-btn.primary {
      background: #3370ff; color: #fff; border-color: #3370ff;
    }
    .topbar-btn.primary:hover { background: #245bdb; border-color: #245bdb; }
    .topbar-btn.primary svg { color: #fff; }

    /* ===== Content ===== */
    .content-wrap {
      flex: 1; overflow-y: auto; display: flex; justify-content: center; padding: 28px;
    }
    .content-wrap.pdf-mode { padding: 0; }
    .content-card {
      width: 100%; max-width: 820px; background: #fff; border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0,0,0,.04), 0 1px 2px rgba(0,0,0,.02);
      padding: 40px 48px 60px; min-height: 400px;
    }
    .content-wrap.pdf-mode .content-card {
      max-width: 100%; border-radius: 0; padding: 0; box-shadow: none;
      min-height: 100%;
    }
    .pdf-iframe { width: 100%; height: 100%; border: none; }

    /* ===== Markdown Styles ===== */
    .content-card h1 {
      font-size: 28px; font-weight: 700; color: #1f2329; margin-bottom: 8px;
      line-height: 1.35; letter-spacing: -.02em;
    }
    .content-card h2 {
      font-size: 22px; font-weight: 600; color: #1f2329; margin-top: 36px; margin-bottom: 12px;
      padding-bottom: 8px; border-bottom: 1px solid #f0f1f5; line-height: 1.4;
    }
    .content-card h3 { font-size: 17px; font-weight: 600; color: #1f2329; margin-top: 24px; margin-bottom: 8px; }
    .content-card h4 { font-size: 15px; font-weight: 600; color: #1f2329; margin-top: 20px; margin-bottom: 6px; }
    .content-card p { line-height: 1.8; color: #3b3e45; margin: 8px 0; font-size: 15px; }
    .content-card a { color: #3370ff; text-decoration: none; }
    .content-card a:hover { text-decoration: underline; }
    .content-card img { max-width: 100%; height: auto; margin: 12px 0; border-radius: 8px; }
    .content-card ul, .content-card ol { padding-left: 24px; margin: 8px 0; color: #3b3e45; }
    .content-card li { margin: 4px 0; line-height: 1.8; font-size: 15px; }
    .content-card pre {
      background: #f7f8fa; border: 1px solid #eef0f3; padding: 16px 20px;
      border-radius: 8px; overflow-x: auto; font-size: 13px; line-height: 1.6;
      margin: 12px 0;
    }
    .content-card code {
      font-family: "SF Mono", "Fira Code", "Consolas", monospace;
      font-size: 13px;
    }
    .content-card p code, .content-card li code {
      background: #f0f1f5; padding: 2px 6px; border-radius: 4px; color: #d63384;
    }
    .content-card blockquote {
      border-left: 3px solid #3370ff; padding: 12px 16px; margin: 16px 0;
      background: #f7f9ff; border-radius: 0 8px 8px 0; color: #4e5969;
    }
    .content-card blockquote p { margin: 0; color: #4e5969; }
    .content-card table { width: 100%; border-collapse: collapse; margin: 16px 0; font-size: 14px; }
    .content-card table th {
      background: #f7f8fa; font-weight: 600; text-align: left;
      padding: 10px 14px; border: 1px solid #e5e6eb; color: #1f2329;
    }
    .content-card table td { padding: 10px 14px; border: 1px solid #e5e6eb; color: #3b3e45; }
    .content-card table tr:hover td { background: #fafbfc; }
    .content-card hr { border: none; border-top: 1px solid #eef0f3; margin: 24px 0; }
    .content-card strong { font-weight: 600; color: #1f2329; }

    /* ===== Placeholder ===== */
    .placeholder-msg {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      height: 100%; color: #8f959e; gap: 16px; padding-bottom: 80px;
    }
    .placeholder-msg .ph-icon {
      width: 80px; height: 80px; border-radius: 20px; background: #f0f1f5;
      display: flex; align-items: center; justify-content: center;
    }
    .placeholder-msg .ph-icon svg { width: 36px; height: 36px; color: #c9cdd4; }
    .placeholder-msg .ph-text { font-size: 14px; }

    /* ===== Toast ===== */
    .toast-msg {
      position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%) translateY(10px);
      background: #1f2329; color: #fff; padding: 10px 24px; border-radius: 8px;
      font-size: 13px; opacity: 0; transition: all .3s ease; pointer-events: none; z-index: 99;
      box-shadow: 0 4px 12px rgba(0,0,0,.15);
    }
    .toast-msg.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    /* ===== Mobile Sidebar Toggle ===== */
    .mobile-toggle {
      display: none; width: 36px; height: 36px; border-radius: 8px; border: 1px solid #dee0e3;
      background: #fff; cursor: pointer; align-items: center; justify-content: center;
    }
    .mobile-toggle svg { width: 18px; height: 18px; color: #646a73; }
    .sidebar-overlay {
      display: none; position: fixed; inset: 0; background: rgba(0,0,0,.3); z-index: 50;
    }

    @media (max-width: 768px) {
      .sidebar {
        position: fixed; left: 0; top: 0; bottom: 0; z-index: 60;
        width: min(260px, 80vw); min-width: auto;
        transform: translateX(-100%); box-shadow: 4px 0 16px rgba(0,0,0,.08);
      }
      .sidebar.open { transform: translateX(0); }
      .sidebar-overlay.open { display: block; }
      .mobile-toggle { display: inline-flex; }
      .content-card { padding: 24px 20px 40px; border-radius: 0; }
      .content-wrap { padding: 0; }
      .topbar { padding: 0 12px; height: 48px; }
      .topbar-title { font-size: 14px; }
      .topbar-btn { padding: 5px 10px; font-size: 12px; }
      .topbar-btn svg { width: 12px; height: 12px; }
      .topbar-actions { gap: 4px; }
      .sidebar-search input { height: 36px; font-size: 14px; }
      .nav-item a { padding: 10px 12px; font-size: 15px; }
    }
  </style>
</head>
<body>
  <div class="layout">
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <div class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-title">在线文档</div>
      </div>
      <div class="sidebar-search">
        <div class="search-wrap">
          <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          <input type="text" id="search" placeholder="搜索文档...">
        </div>
      </div>
      <div class="sidebar-nav" id="nav">
      </div>
    </div>

    <div class="main-area">
      <div class="topbar" id="topbar">
        <div style="display:flex;align-items:center;gap:10px;">
          <button class="mobile-toggle" id="menuBtn">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
          </button>
          <div class="topbar-title" id="topbarTitle">选择一篇文档开始阅读</div>
        </div>
        <div class="topbar-actions" id="topbarActions" style="display:none">
        </div>
      </div>

      <div class="content-wrap" id="contentWrap">
        <div class="content-card" id="content">
          <div class="placeholder-msg">
            <div class="ph-text" style="font-size:22px;font-weight:600;color:#1f2329;">学习，学习，学习。</div>
            <div class="ph-text" style="color:#646a73;margin-top:4px;">一寸光阴一寸金，寸金难买寸光阴，没有什么是学不会的。</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast-msg" id="toast"></div>

  <script src="libs/marked.min.js"></script>
  <script src="libs/jszip.min.js"></script>
  <script src="folders.js"></script>
  <script>
    const nav = document.getElementById('nav');
    const content = document.getElementById('content');
    const contentWrap = document.getElementById('contentWrap');
    const topbarTitle = document.getElementById('topbarTitle');
    const topbarActions = document.getElementById('topbarActions');
    const searchInput = document.getElementById('search');
    const toast = document.getElementById('toast');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    let currentFolder = null;

    document.getElementById('menuBtn').addEventListener('click', () => {
      sidebar.classList.toggle('open');
      sidebarOverlay.classList.toggle('open');
    });
    sidebarOverlay.addEventListener('click', () => {
      sidebar.classList.remove('open');
      sidebarOverlay.classList.remove('open');
    });

    function showToast(msg) {
      toast.textContent = msg;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 1800);
    }

    function getItem(path) { return folders.find(f => f.path === path); }

    const expandedGroups = {};

    function renderNav(filter) {
      const kw = (filter || '').toLowerCase();
      const isSearching = kw.length > 0;
      const list = folders.filter(f => f.name.toLowerCase().includes(kw) || (f.category && f.category.toLowerCase().includes(kw)));
      if (!list.length) {
        nav.innerHTML = '<div style="padding:24px;text-align:center;color:#8f959e;font-size:13px">没有找到匹配的文档</div>';
        return;
      }
      const groups = {};
      list.forEach(f => {
        const cat = f.category || '未分类';
        if (!groups[cat]) groups[cat] = [];
        groups[cat].push(f);
      });
      let html = '';
      for (const [cat, items] of Object.entries(groups)) {
        const isOpen = isSearching || expandedGroups[cat];
        html += `<div class="nav-group-label${isOpen ? ' open' : ''}" data-cat="${cat}">
          <svg class="arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 6 15 12 9 18"/></svg>
          ${cat}
        </div>`;
        html += `<div class="nav-group-items${isOpen ? ' open' : ''}" data-cat="${cat}">`;
        html += items.map(f => {
          const active = f.path === currentFolder ? ' active' : '';
          const icon = f.type === 'pdf' ? 'bi-file-earmark-pdf' : 'bi-file-earmark-text';
          return `<div class="nav-item"><a class="${active}" data-folder="${f.path}">
            <i class="nav-icon bi ${icon}"></i>
            <span class="nav-label">${f.name}</span>
          </a></div>`;
        }).join('');
        html += '</div>';
      }
      nav.innerHTML = html;
      nav.querySelectorAll('.nav-group-label').forEach(label => {
        label.addEventListener('click', () => {
          const cat = label.dataset.cat;
          expandedGroups[cat] = !expandedGroups[cat];
          label.classList.toggle('open');
          nav.querySelector(`.nav-group-items[data-cat="${cat}"]`).classList.toggle('open');
        });
      });
      nav.querySelectorAll('.nav-item a').forEach(a => {
        a.addEventListener('click', () => {
          loadDoc(a.dataset.folder);
          sidebar.classList.remove('open');
          sidebarOverlay.classList.remove('open');
        });
      });
    }

    async function loadDoc(folderPath) {
      const item = getItem(folderPath);
      if (!item) return;
      if (item.type === 'pdf') {
        window.open(folderPath + '/index.pdf', '_blank');
      } else {
        window.open('reader.html?folder=' + encodeURIComponent(folderPath) + '&name=' + encodeURIComponent(item.name), '_blank');
      }
    }

    async function loadPdf(folderPath) {}
    async function loadMarkdown(folderPath) {}

    searchInput.addEventListener('input', e => renderNav(e.target.value));
    renderNav();
  </script>
</body>
</html>
